{% extends 'base.html' %}

{% block title %}สรุปรายงานสต็อกรายช่วงเวลา{% endblock %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/th.js"></script>

    <style>
        :root {
            --primary-color: #007bff;
            --primary-dark: #0056b3;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --text-dark: #343a40;
            --text-light: #6c757d;
            --text-white: #ffffff;
            --bg-white: #ffffff;
            --bg-light: #f8f9fa;
            --bg-stripe: #e9ecef;
            --bg-hover: #f1f1f1;
            --border-color: #dee2e6;
            --border-radius: 6px;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background-color: var(--bg-light);
        }

        .container {
            max-width: 1100px;
            margin: 30px auto;
            background: var(--bg-white);
            padding: 25px 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .page-header {
            font-size: 2.2em;
            font-weight: bold;
            text-align: center;
            color: var(--primary-dark);
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .date-selector-form form {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .date-selector-form label {
            font-weight: bold;
        }

        .date-selector-form input[type="date"] {
            padding: 6px 10px;
            font-size: 0.9em;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }

        .date-selector-form button {
            background-color: var(--primary-color);
            color: var(--text-white);
            border: none;
            padding: 7px 16px;
            border-radius: var(--border-radius);
            font-weight: bold;
            cursor: pointer;
        }

        .summary-period-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .summary-period-header h2 {
            margin-bottom: 10px;
        }

        .overall-summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .summary-info-card {
            padding: 15px;
            border-radius: var(--border-radius);
            background-color: var(--bg-light);
            text-align: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .summary-info-card h4 {
            margin-bottom: 10px;
            color: var(--primary-dark);
        }

        .summary-info-card .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .text-success { color: var(--success-color); }
        .text-danger { color: var(--danger-color); }
        .text-primary { color: var(--primary-color); }

        .brand-summary-section, .detailed-report-section {
            margin-bottom: 40px;
        }

        .brand-summary-table, .detailed-report-table {
            width: 100%;
            border-collapse: collapse;
        }

        .brand-summary-table th,
        .detailed-report-table th,
        .brand-summary-table td,
        .detailed-report-table td {
            padding: 10px;
            border: 1px solid var(--border-color);
            font-size: 0.9em;
        }

        .brand-summary-table th,
        .detailed-report-table th {
            background-color: var(--primary-color);
            color: white;
            text-align: left;
        }

        .brand-summary-table tr:nth-child(even),
        .detailed-report-table tr:nth-child(even) {
            background-color: var(--bg-stripe);
        }

        .brand-group-header {
            background: var(--primary-dark);
            color: white;
            padding: 8px 12px;
            font-size: 1.1em;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }
    </style>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-header">สรุปรายงานสต็อกรายช่วงเวลา</h1>

    <div class="date-selector-form">
        <form action="{{ url_for('summary_stock_report') }}" method="GET">
            <label for="start_date">จากวันที่:</label>
            <input type="date" id="start_date" name="start_date" value="{{ start_date_param }}">
            <label for="end_date">ถึงวันที่:</label>
            <input type="date" id="end_date" name="end_date" value="{{ end_date_param }}">
            <button type="submit">ดูรายงาน</button>
        </form>
    </div>

    <div class="summary-period-header">
        <h2>รายงานสต็อกยางและล้อแม็ก</h2>
        <h3>ช่วงวันที่: {{ display_range_str }}</h3>
    </div>

    <!-- Summary Cards -->
    <div class="overall-summary-cards">
        {% for title, value, cls in [
            ('ยางรวม: ยอดเริ่มต้น', overall_tire_initial, 'text-primary'),
            ('ยางรวม: รับเข้า', overall_tire_in, 'text-success'),
            ('ยางรวม: จ่ายออก', overall_tire_out, 'text-danger'),
            ('ยางรวม: ยอดคงเหลือ', overall_tire_final, 'text-primary'),
            ('แม็กรวม: ยอดเริ่มต้น', overall_wheel_initial, 'text-primary'),
            ('แม็กรวม: รับเข้า', overall_wheel_in, 'text-success'),
            ('แม็กรวม: จ่ายออก', overall_wheel_out, 'text-danger'),
            ('แม็กรวม: ยอดคงเหลือ', overall_wheel_final, 'text-primary')
        ] %}
        <div class="summary-info-card">
            <h4>{{ title }}</h4>
            <div class="value {{ cls }}">{{ value }}</div>
        </div>
        {% endfor %}
    </div>

    <!-- Brand Summary -->
    <div class="brand-summary-section">
        <h3>สรุปยอดรวมแยกตามยี่ห้อ</h3>
        {% if brand_overall_summary_list %}
        <table class="brand-summary-table">
            <thead>
                <tr>
                    <th>ยี่ห้อ</th>
                    <th>ยอดเริ่มต้น</th>
                    <th>รับเข้า</th>
                    <th>จ่ายออก</th>
                    <th>คงเหลือ</th>
                </tr>
            </thead>
            <tbody>
                {% for brand_summary in brand_overall_summary_list %}
                <tr>
                    <td>{{ brand_summary.brand_name | title }}</td>
                    <td>{{ brand_summary.initial_quantity }}</td>
                    <td class="text-success">+{{ brand_summary.IN }}</td>
                    <td class="text-danger">-{{ brand_summary.OUT }}</td>
                    <td class="text-primary">{{ brand_summary.final_quantity }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>ไม่พบข้อมูลแยกตามยี่ห้อ</p>
        {% endif %}
    </div>
</div>
<script>
    flatpickr("#start_date", { dateFormat: "Y-m-d", locale: "th" });
    flatpickr("#end_date", { dateFormat: "Y-m-d", locale: "th" });
</script>
{% endblock %}
